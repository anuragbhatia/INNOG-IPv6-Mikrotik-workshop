---
  - hosts: localhost 
    gather_facts: no

    vars:
        api_key: "{{ lookup('ini', 'api_key type=properties file=~/.vultr.config') }}"
        
    tasks: 

      - name: Create VM to run Radius server 
        ngine_io.vultr.vultr_server:
          api_account: default
          api_retries: 1
          name: radius.lab.innog.net
          os: Ubuntu 20.04 x64
          plan: 1024 MB RAM,25 GB SSD,1.00 TB BW
          ssh_keys: 
              - anurag-laptop
              - anurag@devops01.nue.anuragbhatia.com
          region: Singapore
          state: present
          force: yes

      - name: Attach to mgmt network
        shell: ../common/private-network-manage.sh "{{ item.router }}" mgmt "{{ item.action }}"
        args:
          executable: /bin/bash
        loop:           
        - {router: 'radius.lab.innog.net', action: 'add'}
